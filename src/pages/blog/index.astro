---
import { getCollection } from "astro:content";
import Site from "../../layouts/Site.astro";
import PostList from "../../components/PostList.svelte";
import { getPostInfo, type PostInfo } from "../../lib/post";

const posts: PostInfo[] = (await getCollection("blog"))
  .filter((post: any) => post.data.published)
  .sort((a: any, b: any) => b.data.date.valueOf() - a.data.date.valueOf())
  .map(getPostInfo);

const tagSet: Set<string> = posts.reduce((acc, post) => {
  post.tags.forEach((tag) => {
    acc.add(tag);
  });
  return acc;
}, new Set<string>());

// make sure notes goes first
tagSet.delete("notes");
const tags: string[] = ["notes", ...Array.from(tagSet).sort()];
---

<Site>
  <PostList {posts} {tags} client:load />
</Site>
